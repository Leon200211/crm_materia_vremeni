<?php# =========================================================# Главная страница после входа содержит данные юзера и уведомления по заказам# ======================================================session_start();if(empty($_SESSION['user']) OR ($_SESSION['state'] != 'admin' AND $_SESSION['state'] != 'designer' AND $_SESSION['state'] != 'workshop')){    echo "Доступ запрещен";    die;}require_once "connect_to_database.php";?><!DOCTYPE html><html><head>    <meta name="viewport" content="width=device-width, initial-scale=1">    <meta charset="utf-8">    <link rel="icon" href="assets/img/pink_img/price_top_new.png" type="image/x-icon">    <link rel="stylesheet" href="assets/css/common_styles/common_style.css">    <link rel="stylesheet" href="assets/css/common_styles/style_result.css">    <link rel="stylesheet" href="assets/css/common_styles/table_room_style.css">    <link rel="stylesheet" href="assets/css/style_main_page/style_for_work_with_main_page.css">    <title>Pink</title>    <script src="https://kit.fontawesome.com/58ebeca16e.js" crossorigin="anonymous"></script>    <script src="assets/script/paint.js" defer></script>    <script src="assets/script/app.js" defer></script></head><body style="background-color: #F3F3F3"><header class="header">     <?php        include('header.php');    ?></header><div class="common_div_body">    <div class="main_page_body">        <div class="main_page_body_column_1">            <div class="main_page_body_column_1_title">                Необходимо выполнить:            </div>            <div class="main_page_body_column_1_table">                <div class="scroll-table">                    <table>                        <thead>                        <tr>                            <th>Номер</th>                            <th>Статус</th>                            <th>Отметка</th>                        </tr>                        </thead>                    </table>                    <div class="scroll-table-body">                        <table>                            <tbody>                            <?php                            if($_SESSION['state']=='designer'){                                $sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` = 'Создание роз. стр.'";                                $select = mysqli_query($connect, $sql);                                while ($select_while = mysqli_fetch_assoc($select)) {                                    if($select_while['executor_id'] == $_SESSION["id_user"]){                                        ?>                                        <tr>                                            <td class="id_href">                                                <a href="working_with_orders/pink_all_elements_of_the_mutable.php?id_pink_order=<?= $select_while['id_pink_order'] ?>"><?= $select_while['id_pink_order'] . " | " . $select_while['customer_name']?></a>                                            </td>                                            <td><?= $select_while['pink_state'] ?></td>                                        <?php                                        $id_order = $select_while['id_pink_order'];                                        $sql_date = "SELECT `date_create` FROM `orders_date` WHERE `id_order` = '$id_order'";                                        $select_date = mysqli_query($connect, $sql_date);                                        $select_date = mysqli_fetch_assoc($select_date);                                        // сверяем на просрочку                                        $date_1 = $select_date['date_create'];                                        $date = new DateTime($date_1);                                        $date->modify('+1 day');                                        $date = $date->format('Y-m-d');                                        $today = date("Y-m-d");                                        $result = strtotime($today) <= strtotime($date);                                        if(!$result) {                                            ?>                                                <td style="background-color: red;">нужно доделать розовую страницу  (просрочено)</td>                                            </tr>                                            <?php                                        }else {                                            ?>                                                <td>нужно доделать розовую страницу</td>                                            </tr>                                            <?php                                        }                                    }                                }                                $sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` = 'Создание эскизов'";                                $select = mysqli_query($connect, $sql);                                while ($select_while = mysqli_fetch_assoc($select)) {                                    if($select_while['executor_id'] == $_SESSION["id_user"]){                                        ?>                                            <tr>                                                <td class="id_href">                                                    <a href="work_with_sketches/sketches_room.php?id_pink_order=<?= $select_while['id_pink_order'] ?>"><?= $select_while['id_pink_order'] . " | " . $select_while['customer_name']?></a>                                                </td>                                                <td><?= $select_while['pink_state'] ?></td>                                        <?php                                        // достаем дату                                        $id_order = $select_while['id_pink_order'];                                        $sql_date = "SELECT `date_create` FROM `orders_date` WHERE `id_order` = '$id_order'";                                        $select_date = mysqli_query($connect, $sql_date);                                        $select_date = mysqli_fetch_assoc($select_date);                                        // сверяем на просрочку                                        $date_1 = $select_date['date_create'];                                        $date = new DateTime($date_1);                                        $date->modify('+2 day');                                        $date = $date->format('Y-m-d');                                        $today = date("Y-m-d");                                        $result = strtotime($today) <= strtotime($date);                                        if(!$result) {                                            ?>                                            <td style="background-color: red;">нужно доделать эскизы (просрочено)</td>                                            </tr>                                            <?php                                        }else {                                            ?>                                            <td>нужно доделать эскизы</td>                                            </tr>                                            <?php                                        }                                    }                                }                                $sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` = 'Возврат дизайнеру'                                     OR `pink_state` = 'Перевыбор ткани в салоне'";                                $select = mysqli_query($connect, $sql);                                while ($select_while = mysqli_fetch_assoc($select)) {                                    if($select_while['executor_id'] == $_SESSION["id_user"]){                                        ?>                                        <tr>                                        <td class="id_href">                                            <a href="work_with_sketches/sketches_room.php?id_pink_order=<?= $select_while['id_pink_order'] ?>"><?= $select_while['id_pink_order'] . " | " . $select_while['customer_name']?></a>                                        </td>                                        <td style="background-color: red;"><?= $select_while['pink_state'] ?></td>                                        <?php                                        // достаем дату                                        $id_order = $select_while['id_pink_order'];                                        $sql_date = "SELECT `date_create` FROM `orders_date` WHERE `id_order` = '$id_order'";                                        $select_date = mysqli_query($connect, $sql_date);                                        $select_date = mysqli_fetch_assoc($select_date);                                        // сверяем на просрочку                                        $date_1 = $select_date['date_create'];                                        $date = new DateTime($date_1);                                        $date->modify('+2 day');                                        $date = $date->format('Y-m-d');                                        $today = date("Y-m-d");                                        $result = strtotime($today) <= strtotime($date);                                        if(!$result) {                                            ?>                                            <td style="background-color: red;">нужно доделать эскизы (просрочено)</td>                                            </tr>                                            <?php                                        }else {                                            ?>                                            <td>нужно доделать эскизы</td>                                            </tr>                                            <?php                                        }                                    }                                }                            } else if($_SESSION['state']=='workshop'){                                $sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` = 'Поступил в цех' AND                                        `pink_state` = 'Выдан закройщику' AND `pink_state` = 'Пошив' AND                                        `pink_state` = 'Ожидание отправки в салон'";                                $select = mysqli_query($connect, $sql);                                while ($select_while = mysqli_fetch_assoc($select)) {                                    ?>                                    <tr>                                        <td class="id_href">                                            <a href="execution_process/order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>"><?= $select_while['id_pink_order']?></a>                                        </td>                                        <td><?= $select_while['pink_state'] ?></td>                                        <td>нужно доделать заказ</td>                                    </tr>                                    <?php                                }                            }else if($_SESSION['state']=='admin'){                                $sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` != 'Завершен'";                                $select = mysqli_query($connect, $sql);                                while ($select_while = mysqli_fetch_assoc($select)) {                                    if($select_while['pink_state'] == "Создание роз. стр." OR $select_while['pink_state'] == "Создание эскизов"){                                        ?>                                        <tr>                                            <td class="id_href">                                                <a href="execution_process/order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>"><?= $select_while['id_pink_order'] . " | " . $select_while['customer_name']?></a>                                            </td>                                            <td><?= $select_while['pink_state'] ?></td>                                            <?php                                        $id_order = $select_while['id_pink_order'];                                        $sql_date = "SELECT `date_create` FROM `orders_date` WHERE `id_order` = '$id_order'";                                        $select_date = mysqli_query($connect, $sql_date);                                        $select_date = mysqli_fetch_assoc($select_date);                                        // сверяем на просрочку                                        $date_1 = $select_date['date_create'];                                        $date = new DateTime($date_1);                                        $date->modify('+1 day');                                        $date = $date->format('Y-m-d');                                        $today = date("Y-m-d");                                        $result = strtotime($today) <= strtotime($date);                                        if(!$result) {                                            ?>                                            <td style="background-color: red;">В процессе (просрочено)</td>                                            </tr>                                            <?php                                        }else {                                            ?>                                            <td>В процессе</td>                                            </tr>                                            <?php                                        }                                    }else {                                        ?>                                        <tr>                                            <td class="id_href">                                                <a href="execution_process/order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>"><?= $select_while['id_pink_order'] . " | " . $select_while['customer_name']?></a>                                            </td>                                            <td><?= $select_while['pink_state'] ?></td>                                            <td>В процессе</td>                                        </tr>                                        <?php                                    }                                }                            }                            ?>                            </tbody>                        </table>                    </div>                </div>            </div>        </div>        <div class="main_page_body_column_2">            <div class="main_page_body_column_2_elem_one">                <div class="getting_info">                    <div class="getting_info_item">Имя: <?= $_SESSION['name'] ?></div>                    <div class="getting_info_item">Статус: <?= $_SESSION['state'] ?> </div>                    <div class="getting_info_item">Номер: <?= $_SESSION['phone'] ?> </div>                </div>            </div>            <div class="main_page_body_column_2_elem_two">                <div class="main_page_body_column_1_title">                    Важные уведомления:                </div>                <div class="important_indicator">                <?php                //$sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` = 'Возврат дизайнеру' OR `pink_state` = 'Перевыбор ткани в салоне' OR `pink_state` = 'Возврат ткани'";                $sql = "SELECT * FROM `notice_important` WHERE `id_user` = '{$_SESSION['id_user']}'";                $select = mysqli_query($connect, $sql);                while ($select_while = mysqli_fetch_assoc($select)) {                    ?>                    <a href="execution_process/order_full_info_new.php?id=<?= $select_while['id_order'] ?>" class="important_indicator_href">                        <div class="important_indicator_block">                            <div class="important_indicator_block_text">                                Заказ № <?=$select_while['id_order']?>                            </div>                            <div class="important_indicator_block_text">                                Статус: <?= $select_while['note'] ?>                            </div>                        </div>                    </a>                <?php                }                ?>                </div>            </div>        </div>    </div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script></body></html>