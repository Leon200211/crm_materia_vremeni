<?php#======================================================================# Список всех текущих заказов с уведомлением на них#======================================================================session_start();if(empty($_SESSION['user']) OR ($_SESSION['state'] != 'admin' AND $_SESSION['state'] != 'designer' AND $_SESSION['state'] != 'workshop')){    echo "Доступ запрещен";    die;}require_once "../connect_to_database.php";require_once "../global_functions.php";?><!DOCTYPE html><html><head>    <meta name="viewport" content="width=device-width, initial-scale=1">    <meta charset="utf-8">    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap-grid.css">    <link rel="stylesheet" href="../assets/css/common_styles/common_style.css">    <link rel="stylesheet" href="../assets/css/common_styles/style_result.css">    <link rel="stylesheet" href="../assets/css/execution_process/all_orders_page.css">    <title>Pink</title>    <script src="https://kit.fontawesome.com/58ebeca16e.js" crossorigin="anonymous"></script>    <script src="../assets/script/app.js" defer></script></head><body style="background-color: #F3F3F3"><header class="header">     <?php        include('../header.php');    ?></header><div class="common_div_body">    <div class="col-md-12 products">        <div class="row">                <?php                //$sql = "SELECT * FROM `orders_main_info`  WHERE `pink_state` != 'Завершен'";   // сначала старые                $sql = "SELECT * FROM `orders_main_info` WHERE `pink_state` != 'Завершен' ORDER BY `id` DESC";  // сначала новые                $select = mysqli_query($connect, $sql);                while ($select_while = mysqli_fetch_assoc($select)) {                    // достаем дату                    $id_order = $select_while['id_pink_order'];                    $sql_date = "SELECT `date_create` FROM `orders_date` WHERE `id_order` = '$id_order'";                    $select_date = mysqli_query($connect, $sql_date);                    $select_date = mysqli_fetch_assoc($select_date);                    $data = DateTime::createFromFormat('Y-m-d', $select_date['date_create']);                    $data = $data->format('d-m-Y');                    if($_SESSION['state'] == "designer" and $select_while['executor_id'] == $_SESSION["id_user"]){                        if($select_while['pink_state'] == "Создание роз. стр." or                            $select_while['pink_state'] == "Создание эскизов" or                            $select_while['pink_state'] == "Заказ без пошива" or                            $select_while['pink_state'] == "Поступил в цех" or                            $select_while['pink_state'] == "Выдан закройщику" or                            $select_while['pink_state']  == "Пошив" or                            $select_while['pink_state'] == "Ожидание отправки в салон" or                            $select_while['pink_state'] == "Доставка в салон" or                            $select_while['pink_state'] == "Поступил в салон" or                            $select_while['pink_state'] == "Доставка клиенту" or                            $select_while['pink_state'] == "Возврат дизайнеру" or                            $select_while['pink_state'] == "Брак ткани" or                            $select_while['pink_state'] == "Перевыбор ткани в салоне" or                            $select_while['pink_state'] == "Возврат ткани")                        {                            //  -------------------------------                            //  для проверки на уведомления                            $css_class = 'product'; // стиль для кнопки                            $user_id = $_SESSION['id_user'];                            $id_pink_order = $select_while['id_pink_order'];                            // проверяем если ли уведомление                            $select_test = mysqli_query($connect, "SELECT * FROM `notice` WHERE `id_user` = '$user_id' AND `id_order` = '$id_pink_order'");                            $select_test = mysqli_fetch_assoc($select_test);                            if(!empty($select_test['id'])){                                $css_class = 'product_notification';                            }                            // ==============================                            ?>                            <div class="col-sm-4">                                <div class="<?=$css_class?>">                                    <a href="order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>">                                        <div class="product_body">                                            <div>                                                <div class="product_title">Заказ №<?=$select_while['id_pink_order']?></div>                                                <div>Дата: <?=$data?></div>                                            </div>                                            <div>                                                <div class="product_state">Статус: <?=$select_while['pink_state']?></div>                                                <div>Дизайнер: <?= get_designer_name($connect, $select_while['executor_id']) ?></div>                                            </div>                                        </div>                                    </a>                                </div>                            </div>                            <?php                        }                    }                    if($_SESSION['state'] == "workshop"){                        if($_SESSION['id_user'] != $select_while['executor_id'] and ($select_while['pink_state'] == "Создание роз. стр." or                                $select_while['pink_state'] == "Создание эскизов" or                                $select_while['pink_state'] == "Поступил в цех" or                                $select_while['pink_state'] == "Выдан закройщику" or                                $select_while['pink_state']  == "Пошив" or                                $select_while['pink_state']  == "Ожидание отправки в салон" or                                $select_while['pink_state']  == "Возврат дизайнеру" or                                $select_while['pink_state']  == "Брак ткани" or                                $select_while['pink_state']  == "Перевыбор ткани в салоне" or                                $select_while['pink_state']  == "Возврат ткани"))                        {                            //  -------------------------------                            //  для проверки на уведомления                            $css_class = 'product'; // стиль для кнопки                            $user_id = $_SESSION['id_user'];                            $id_pink_order = $select_while['id_pink_order'];                            // проверяем если ли уведомление                            $select_test = mysqli_query($connect, "SELECT * FROM `notice` WHERE `id_user` = '$user_id' AND `id_order` = '$id_pink_order'");                            $select_test = mysqli_fetch_assoc($select_test);                            if(!empty($select_test['id'])){                                $css_class = 'product_notification';                            }                            // ==============================                            ?>                            <div class="col-sm-4">                                <div class="<?=$css_class?>">                                    <a href="order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>">                                        <div class="product_body">                                            <div>                                                <div class="product_title">Заказ №<?=$select_while['id_pink_order']?></div>                                                <div>Дата: <?=$data?></div>                                            </div>                                            <div>                                                <div class="product_state">Статус: <?=$select_while['pink_state']?></div>                                                <div>Дизайнер: <?= get_designer_name($connect, $select_while['executor_id']) ?></div>                                            </div>                                        </div>                                    </a>                                </div>                            </div>                            <?php                            // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!                            // если заказ был создан кем то из цеха становится ли у него больше зона видимости заказа?                        }elseif ($_SESSION['id_user'] == $select_while['executor_id'] and($select_while['pink_state'] == "Создание роз. стр." or                                $select_while['pink_state'] == "Создание эскизов" or                                $select_while['pink_state'] == "Заказ без пошива" or                                $select_while['pink_state'] == "Поступил в цех" or                                $select_while['pink_state'] == "Выдан закройщику" or                                $select_while['pink_state']  == "Пошив" or                                $select_while['pink_state'] == "Ожидание отправки в салон" or                                $select_while['pink_state'] == "Доставка в салон" or                                $select_while['pink_state'] == "Поступил в салон" or                                $select_while['pink_state'] == "Доставка клиенту" or                                $select_while['pink_state'] == "Возврат дизайнеру" or                                $select_while['pink_state'] == "Брак ткани" or                                $select_while['pink_state'] == "Перевыбор ткани в салоне" or                                $select_while['pink_state'] == "Возврат ткани")){                            //  -------------------------------                            //  для проверки на уведомления                            $css_class = 'product'; // стиль для кнопки                            $user_id = $_SESSION['id_user'];                            $id_pink_order = $select_while['id_pink_order'];                            // проверяем если ли уведомление                            $select_test = mysqli_query($connect, "SELECT * FROM `notice` WHERE `id_user` = '$user_id' AND `id_order` = '$id_pink_order'");                            $select_test = mysqli_fetch_assoc($select_test);                            if(!empty($select_test['id'])){                                $css_class = 'product_notification';                            }                            // ==============================                            ?>                            <div class="col-sm-4">                                <div class="<?=$css_class?>">                                    <a href="order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>">                                        <div class="product_body">                                            <div>                                                <div class="product_title">Заказ №<?=$select_while['id_pink_order']?></div>                                                <div>Дата: <?=$data?></div>                                            </div>                                            <div>                                                <div class="product_state">Статус: <?=$select_while['pink_state']?></div>                                                <div>Дизайнер: <?= get_designer_name($connect, $select_while['executor_id']) ?></div>                                            </div>                                        </div>                                    </a>                                </div>                            </div>                            <?php                        }                    }                    if($_SESSION['state'] == "admin"){                        if($select_while['pink_state'] != "Завершен"){                            //  -------------------------------                            //  для проверки на уведомления                            $css_class = 'product'; // стиль для кнопки                            $user_id = $_SESSION['id_user'];                            $id_pink_order = $select_while['id_pink_order'];                            // проверяем если ли уведомление                            $select_test = mysqli_query($connect, "SELECT * FROM `notice` WHERE `id_user` = '$user_id' AND `id_order` = '$id_pink_order'");                            $select_test = mysqli_fetch_assoc($select_test);                            if(!empty($select_test['id'])){                                $css_class = 'product_notification';                            }                            // ==============================                            ?>                            <div class="col-sm-4">                                <div class="<?=$css_class?>">                                    <a href="order_full_info_new.php?id=<?= $select_while['id_pink_order'] ?>">                                        <div class="product_body">                                            <div>                                                <div class="product_title">Заказ №<?=$select_while['id_pink_order']?></div>                                                <div>Дата: <?=$data?></div>                                            </div>                                            <div>                                                <div class="product_state">Статус: <?=$select_while['pink_state']?></div>                                                <div>Дизайнер: <?= get_designer_name($connect, $select_while['executor_id']) ?></div>                                            </div>                                        </div>                                    </a>                                </div>                            </div>                            <?php                        }                    }                }                ?>        </div>    </div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script></body></html>