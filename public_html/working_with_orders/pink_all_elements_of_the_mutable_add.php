<?php#========================================================# Выбор товара для добавления в заказ в зависимости от типа#========================================================session_start();if(empty($_SESSION['user']) OR ($_SESSION['state'] != 'admin' AND $_SESSION['state'] != 'designer' AND $_SESSION['state'] != 'workshop')){    echo "Доступ запрещен";    die;}require_once '../connect_to_database.php';//  -------------------------------//  для проверки на создание заказа$id_pink_order = $_GET['id_pink_order'];$sql = "SELECT * FROM `orders_main_info` WHERE `id_pink_order` = '$id_pink_order'";$select = mysqli_query($connect, $sql);$select = mysqli_fetch_assoc($select);if($select['executor_id'] != $_SESSION['id_user'] and $_SESSION['state'] != 'admin') {    echo "Доступ запрещен";    die;}// --------------------------------------$services_type = 1; // если не услуги// отслеживаем через какую таблицу работаем$tb = $_GET['tb'];if($tb == 1) {    $search = "ткани";    $sql = "SELECT * FROM `cloth`";    $ft_select_1 = "title";    $ft_select_2 = "collection";    $name = 'cloth';    $mas_1 = ['id', 'Артикул', 'Размер', 'Вертикальный', 'Горизонтальный', 'Состав', 'Утяжелитель', 'Цена за рулон', 'Коллекция', 'Поставщик', 'Валюта'];    $mas_2 = ['id', 'title', 'width', 'vertical', 'horizontal', 'compound', 'weighter', 'price', 'collection', 'provider', 'currency'];} else if($tb == 2) {    $search = "Карниз";    $sql = "SELECT * FROM `cornices`";    $ft_select_1 = "title";    $ft_select_2 = "type";    $name = 'cornices';    $mas_1 = ['id', 'Артикул', 'Цена', 'Тип', 'Валюта', 'Поставщик'];    $mas_2 = ['id', 'title', 'price', 'type', 'currency', 'provider'];}else if($tb == 3) {    $search = "Жалюзи";    $sql = "SELECT * FROM `blinds`";    $ft_select_1 = "title";    $ft_select_2 = "type";    $name = 'blinds';    $mas_1 = ['id', 'Артикул', 'Высота', 'Ширина', 'Тип', 'Цвет', 'Цена', 'Валюта', 'Поставщик'];    $mas_2 = ['id', 'title', 'height', 'width', 'type', 'color', 'price', 'currency', 'provider'];}else if($tb == 4) {    $search = "Фурнитура";    $sql = "SELECT * FROM `furniture`";    $ft_select_1 = "title";    $ft_select_2 = "collection";    $name = 'furniture';    $mas_1 = ['id', 'Артикул', 'Коллекция', 'Цена', 'Цена_опт', 'Поставщик', 'Валюта'];    $mas_2 = ['id', 'title', 'collection', 'price', 'price_opt', 'provider', 'currency'];}else if ($tb == 'services') {    $search = "услуг";    $sql = "SELECT * FROM `services`";    $ft_select_1 = "title";    $ft_select_2 = "service_type";    $name = 'services';    $mas_1 = ['id', 'Название', 'Цена', 'Тип', 'Валюта'];    $mas_2 = ['id', 'title', 'price', 'service_type', 'currency'];}$room = $_GET['room'];require_once "../global_functions.php";?><!DOCTYPE html><html><head>    <meta name="viewport" content="width=device-width, initial-scale=1">    <meta charset="utf-8">    <title>Пример веб-страницы</title><!--    <link rel="stylesheet" href="../assets/css/style.css">--><!--    <link rel="stylesheet" href="../assets/css/style_for_paint.css">--><!--    <link rel="stylesheet" href="../assets/css/accountant_stule.css">--><!--    <link rel="stylesheet" href="../assets/css/updata_accountant.css">--><!--    <link rel="stylesheet" href="../assets/css/updata_accountant.css">--><!--    <link rel="stylesheet" href="../assets/css/life_search.css">--><!--    <link rel="stylesheet" href="../assets/css/style_messag.css">--><!--    <link rel="stylesheet" href="../assets/css/full_info_css.css">-->    <link rel="stylesheet" href="../assets/css/common_styles/common_style.css">    <link rel="stylesheet" href="../assets/css/common_styles/style_result.css">    <link rel="stylesheet" href="../assets/css/style_pink_page/update_pink_page.css">    <link rel="stylesheet" href="../assets/css/style_pink_page/style_for_work_with_pink_page.css">    <link rel="stylesheet" href="../assets/css/common_styles/common_life_search.css">    <link rel="stylesheet" href="../assets/css/style_pink_page/style_for_create_order.css">    <link rel="stylesheet" href="../assets/css/style_for_work_with_db/common_style_for_work_with_db.css">    <link rel="stylesheet" href="../assets/css/common_styles/table_room_style.css">    <script src="https://kit.fontawesome.com/58ebeca16e.js" crossorigin="anonymous"></script>    <script src="assets/script/paint.js" defer></script>    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>    <script src="../assets/script/app.js" defer></script></head><body style="background-color: #F3F3F3"><header class="header">    <?php    include('../header.php');    ?></header><div class="common_div_body">    <div>        <div class="back_title">            Заказы / Заказ № <?= $id_pink_order ?>        </div>        <a href="pink_all_elements_of_the_mutable.php?id_pink_order=<?= $_GET['id_pink_order'] ?>" class="common_back_href">Назад</a>    </div>    <div class="main_field_div">        <h1>Поиск <?= $search ?>:</h1>        <!-- Для живого поиска -->        <script src="https://code.jquery.com/jquery-2.1.0.js"></script>        <div                class='hidden'                data-lat='<?= $name ?>'        ></div>        <script>            var tbname = $('div.hidden').data('lat');            $(document).ready(function(){                $("#search").keyup(function(){                    $.ajax({                        url: "../life_search.php",                        type: "POST",                        data: {                            value:  $('#search').val(),                            name: tbname                        },                        success: function(result){                            $("#result").html(result);                        }});                });            });        </script>        <form method="post">            <div class="test_life">                <input type="text" id="search" class="input_style">                <input type="submit" value="Найти" class="common_button">                <br>                <div class="bloc">                    <select id="result" size="10" name="city" class="test_life_2_common">                    </select>                </div>            </div>        </form>        <table class="table_title_info">            <?php            require_once '../connect_to_database.php';            if(!empty($_POST['city'])) {                ?>                <tr>                    <?php                    foreach ($mas_1 as $value) {                        ?>                        <th class="th_title_info"> <?= $value ?> </th>                        <?php                    }                    ?>                </tr>                <?php                $search_get = $_POST['city'];                $sql_2 = "SELECT * FROM `$name` WHERE `id` = '$search_get'";                $select = mysqli_query($connect, $sql_2);                if (!empty($search_get)) {                while ($select_while = mysqli_fetch_assoc($select)) {                ?>                <tr>                    <?php                    foreach ($mas_2 as $value) {                        if($value == 'price' and $name != 'services'){                            ?>                            <td class="tb_title_info">                                <?= show_normal_price($connect, $select_while['price'],                                    $select_while['provider'], $select_while['currency'], $name) ?>                            </td>                            <?php                        }else{                            ?>                            <td class="tb_title_info"><?= $select_while[$value] ?></td>                            <?php                        }                    }                    ?>                </tr>                <?php                }                }                else{                    die('error');                }            }            ?>        </table>    </div></div><div class="common_div_body">    <div class="main_field_div">    <h3 class="update_title">Добавление <?= $search ?></h3>    <form action="pink_all_elements_of_the_mutable_add_main.php" method="post">        <div class="place_find">            <div class="update_product_all">                <input type="hidden" name="id_pink_order" value="<?= $_GET['id_pink_order'] ?>">                <input type="hidden" name="tb" value="<?=$tb?>">                <input type="hidden" name="room" value="<?=$room?>">                <?php                if($tb == 'services'){                    ?>                <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>                <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.3/jquery-ui.min.js"></script>                <script type="text/javascript">                    function select_services() {                        var social = document.getElementById("room");                        var selectSocial = social.options[social.selectedIndex].value;                        if(selectSocial == '--'){                            window.location = "pink_all_elements_of_the_mutable_add.php?id_pink_order=<?=$id_pink_order?>&tb=services&room=--";                        }                        else{                            window.location = "pink_all_elements_of_the_mutable_add.php?id_pink_order=<?=$id_pink_order?>&tb=services&room=" + selectSocial;                        }                    }                </script>                <select name="room" id="room" class="common_select" onchange=select_services()>                    <option value="<?=$room?>">Выбрано: <?=$room?></option>                    <?php                    $info_pink_order_room = mysqli_query($connect, "SELECT distinct `room` FROM `description_of_pink_pages` WHERE `id_pink_order` = '$id_pink_order' AND `room` != '--'");                    while ($info_pink_order_room_while = mysqli_fetch_assoc($info_pink_order_room)) {                        ?>                        <option value="<?=$info_pink_order_room_while['room'];?>"><?=$info_pink_order_room_while['room'];?></option>                    <?php                    }                    ?>                    <option value="--">--</option>                </select>                <?php                    if($tb == 'services' and $room == '--'){                        $name_1 = 'services';                    }else if($tb == 'services' and $room != '--'){                        if($_SESSION['state'] == 'workshop'){                            $name_1 = 'sewing_workshop';                        }else{                            $name_1 = 'sewing_salon';                        }                    }                }else{                    $name_1 = $name;                }                ?>                    <div>                        <div class="text_for_update">Наименование*</div>                        <div class="live_search_new">                            <!-- Для живого поиска -->                            <script src="https://code.jquery.com/jquery-2.1.0.js"></script>                            <div                                    class='hidden_1'                                    data-lat_1='<?= $name_1 ?>'                            ></div>                            <script>                                var tbname_1 = $('div.hidden_1').data('lat_1');                                $(document).ready(function(){                                    $("#search_1_2").keyup(function(){                                        console.log(tbname_1);                                        $.ajax({                                            url: "../life_search.php",                                            type: "POST",                                            data: {                                                value:  $('#search_1_2').val(),                                                name: tbname_1                                            },                                            success: function(result){                                                $("#result_1_2").html(result);                                            }});                                    });                                });                            </script>                            <div class="test_life">                                <input type="text" id="search_1_2" class="input_style">                                <br>                                <div class="bloc">                                    <select id="result_1_2" size="10" name="description" class="test_life_2_common">                                    </select>                                </div>                            </div>                        </div>                    </div>                <?php                if($tb == 'services' and $room != '--'){                    $name_2 = 'difficult_elements';                    ?>                    <div>                        <div class="text_for_update">Усложнение</div>                        <div class="live_search_new">                            <!-- Для живого поиска -->                            <script src="https://code.jquery.com/jquery-2.1.0.js"></script>                            <div                                    class='hidden_2'                                    data-lat_2='<?= $name_2 ?>'                            ></div>                            <script>                                var tbname_2 = $('div.hidden_2').data('lat_2');                                $(document).ready(function(){                                    $("#search_2_2").keyup(function(){                                        $.ajax({                                            url: "../life_search.php",                                            type: "POST",                                            data: {                                                value:  $('#search_2_2').val(),                                                name: tbname_2                                            },                                            success: function(result){                                                $("#result_2_2").html(result);                                            }});                                    });                                });                            </script>                            <div class="test_life">                                <input type="text" id="search_2_2" class="input_style">                                <br>                                <div class="bloc">                                    <select id="result_2_2" size="10" name="description_2" class="test_life_2_common">                                    </select>                                </div>                            </div>                        </div>                    </div>                    <?php                }                if($tb != 'services'){                ?>                    <div class="text_for_update">Цвет</div>                    <input type="text" name="size" class="input_style" maxlength=12 value="">                <?php                }                ?>                <div class="text_for_update">Количество*</div>                <input type="text" name="quantity" class="input_style" maxlength=6 value="">                <br>                <br>                <div>                    <button type="submit" class="common_button">Добавить</button>                </div>            </div>        </div>    </form>    </div></div></body>